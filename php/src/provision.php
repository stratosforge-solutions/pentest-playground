<?php

    //hostname of mysql docker container
    $host="db";

    //from MYSQL_ROOT_PASSWORD docker-compose
    $mysql_root_password='mysqlpentestroot';

    //from MYSQL_DATABASE docker-compose
    $mysql_database = 'pentest';

    //from MYSQL_USER docker-compose
    $mysql_user = "analyst";
    
    //from MYSQL_PASSWORD docker-compose
    $mysql_password = "password123456";

    $con = new mysqli($host, "root", $mysql_root_password);
    if ($con->connect_errno) {
        printf("Connect failed: %s\n", $con->connect_error);
        exit();
    }
    if (!$con->select_db($mysql_database)) {
        echo "<br>Couldn't select database: " . $con->error;
        if (!$con->query("CREATE DATABASE IF NOT EXISTS $mysql_database;")) {
            echo "Couldn't create database: " . $con->error;
        }
        $con->select_db($mysql_database);
        echo("Database created & provisioned!");
    } else {
        echo("Database provisioned!");
        
    }
    echo("<br>Creating users....");
    $sql="CREATE TABLE IF NOT EXISTS appusers (`username` text, `password` text )";
    $con->query($sql) or trigger_error("Query Failed! Error: $sql".mysqli_error($con), E_USER_ERROR);
    $con->query("delete from `appusers`;") or trigger_error("Query Failed! Error: ".mysqli_error($con), E_USER_ERROR);;
    $con->query("insert into `appusers` (username, password) values ('$mysql_user', '$mysql_password');") or trigger_error("Query Failed! Error: ".mysqli_error($con), E_USER_ERROR);
    $con->query("insert into `appusers` (username, password) values ('dog', 'bowowowowowowo');") or trigger_error("Query Failed! SQL: $sql - Error: ".mysqli_error($con), E_USER_ERROR);
    $con->query("insert into `appusers` (username, password) values ('cat', 'catsrulzd');") or trigger_error("Query Failed! SQL: $sql - Error: ".mysqli_error($con), E_USER_ERROR);
    
    echo("<br>Done!");
?>
